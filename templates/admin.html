{% extends "base.html" %}
{% block title %}Admin Paneli{% endblock %}
{% block content %}
<h2>Kullanıcı Yönetimi</h2>
{% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
<form method="post" action="/admin/create" class="mb-3">
  <div class="mb-3">
    <input type="text" name="username" class="form-control" placeholder="Kullanıcı Adı" required>
  </div>
  <div class="mb-3">
    <input type="password" name="password" class="form-control" placeholder="Şifre" required>
  </div>
  <div class="mb-3">
    <input type="text" name="first_name" class="form-control" placeholder="İsim">
  </div>
  <div class="mb-3">
    <input type="text" name="last_name" class="form-control" placeholder="Soyisim">
  </div>
  <div class="mb-3">
    <input type="email" name="email" class="form-control" placeholder="Mail Adresi">
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" name="is_admin" id="is_admin">
    <label class="form-check-label" for="is_admin">Admin</label>
  </div>
  <button type="submit" class="btn btn-primary">Ekle</button>
</form>
<table class="table">
  <thead>
    <tr><th>Kullanıcı Adı</th><th>İsim</th><th>Soyisim</th><th>Mail</th><th>Admin</th><th>İşlem</th></tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.username }}</td>
      <td>{{ u.first_name }}</td>
      <td>{{ u.last_name }}</td>
      <td>{{ u.email }}</td>
      <td>{{ "Evet" if u.is_admin else "Hayır" }}</td>
      <td>
        {% if not u.is_admin %}
        <form method="post" action="/admin/make_admin/{{ u.id }}" style="display:inline">
          <button type="submit" class="btn btn-secondary btn-sm">Admin Yap</button>
        </form>
        <form method="post" action="/admin/delete/{{ u.id }}" style="display:inline">
          <button type="submit" class="btn btn-danger btn-sm">Sil</button>
        </form>
        {% else %}-{% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2>Tablo Yönetimi</h2>
{% if table_error %}<div class="alert alert-danger">{{ table_error }}</div>{% endif %}
<form method="post" action="/admin/tables/create" class="mb-3">
  <div class="mb-3">
    <input type="text" name="table_name" class="form-control" placeholder="Tablo Adı" required>
  </div>
  <button type="submit" class="btn btn-primary">Tablo Oluştur</button>
  </form>
<table class="table">
  <thead>
    <tr><th>Tablo Adı</th><th>Kayıt Sayısı</th><th>İşlem</th></tr>
  </thead>
  <tbody>
    {% for t in tables %}
    <tr>
      <td>{{ t.name }}</td>
      <td>{{ t.count }}</td>
      <td>
        {% if t.count == 0 %}
        <form method="post" action="/admin/tables/delete" style="display:inline">
          <input type="hidden" name="table_name" value="{{ t.name }}">
          <button type="submit" class="btn btn-danger btn-sm">Sil</button>
        </form>
        {% else %}-{% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
