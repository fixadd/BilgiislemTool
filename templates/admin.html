{% extends "base.html" %}
{% block title %}Admin Paneli{% endblock %}
{% block content %}
<h2>Kullanıcı Yönetimi</h2>
{% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
<button id="add-user-btn" class="btn btn-primary mb-3"style="width: 400px;">Kullanıcı Ekle</button>
<form id="add-user-form" method="post" action="/admin/create" class="mb-3 d-none">
  <div class="mb-3" style="width: 400px;">
    <input type="text" name="username" class="form-control" placeholder="Kullanıcı Adı" required>
  </div>
  <div class="mb-3" style="width: 400px;">
    <input type="password" name="password" class="form-control" placeholder="Şifre" required>
  </div>
  <div class="mb-3" style="width: 400px;">
    <input type="text" name="first_name" class="form-control" placeholder="İsim">
  </div>
  <div class="mb-3" style="width: 400px;">
    <input type="text" name="last_name" class="form-control" placeholder="Soyisim">
  </div>
  <div class="mb-3" style="width: 400px;">
    <input type="email" name="email" class="form-control" placeholder="Mail Adresi">
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" name="is_admin" id="is_admin">
    <label class="form-check-label" for="is_admin">Admin</label>
  </div>
  <button type="submit" class="btn btn-primary">Ekle</button>
</form>
<form method="get" action="/admin" class="mb-3 d-flex"style="width: 400px;">
  <input type="text" name="q" class="form-control me-2" placeholder="Kullanıcı Ara" value="{{ q }}">
  <button type="submit" class="btn btn-secondary">Ara</button>
</form>
<table class="table">
  <thead>
    <tr><th>Kullanıcı Adı</th><th>İsim</th><th>Soyisim</th><th>Mail</th><th>Admin</th><th>İşlem</th></tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.username }}</td>
      <td>{{ u.first_name }}</td>
      <td>{{ u.last_name }}</td>
      <td>{{ u.email }}</td>
      <td>{{ "Evet" if u.is_admin else "Hayır" }}</td>
      <td>
        {% if u.username != 'admin' %}
        {% if not u.is_admin %}
        <form method="post" action="/admin/make_admin/{{ u.id }}" style="display:inline">
          <button type="submit" class="btn btn-secondary btn-sm">Admin Yap</button>
        </form>
        {% endif %}
        <a href="/admin/edit/{{ u.id }}" class="btn btn-warning btn-sm">Düzenle</a>
        <form method="post" action="/admin/delete/{{ u.id }}" style="display:inline">
          <button type="submit" class="btn btn-danger btn-sm">Sil</button>
        </form>
        {% else %}-{% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
document.getElementById('add-user-btn').addEventListener('click', function() {
  document.getElementById('add-user-form').classList.toggle('d-none');
});
</script>
{% endblock %}
