{% extends "base.html" %}
{% block title %}Kayıtlar{% endblock %}
{% block content %}
<h2>Kayıtlar</h2>

<form method="get" class="mb-3">
  <label for="log_type">Log türü:</label>
  <select id="log_type" name="log_type" onchange="this.form.submit()">
    <option value="user" {% if log_type == 'user' %}selected{% endif %}>Kullanıcı</option>
    <option value="inventory" {% if log_type == 'inventory' %}selected{% endif %}>Envanter</option>
  </select>
  {% if log_type == 'user' %}
  <label for="username" class="ms-3">Kullanıcı:</label>
  <select id="username" name="username" onchange="this.form.submit()">
    <option value="">Hepsi</option>
    {% for u in users %}
      <option value="{{ u }}" {% if selected_username == u %}selected{% endif %}>{{ u }}</option>
    {% endfor %}
  </select>
  {% elif log_type == 'inventory' %}
  <label for="inventory_no" class="ms-3">Envanter No:</label>
  <select id="inventory_no" name="inventory_no" onchange="this.form.submit()">
    <option value="">Hepsi</option>
    {% for item in inventory_items %}
      <option value="{{ item.inv_no }}" {% if selected_inv_no == item.inv_no %}selected{% endif %}>{{ item.inv_no }}</option>
    {% endfor %}
  </select>
  {% endif %}
</form>

{% if log_type == 'user' %}
<table class="table table-striped table-fixed">
  <thead>
    <tr>
      <th>Tarih</th>
      <th>Kullanıcı</th>
      <th>İşlem</th>
    </tr>
  </thead>
  <tbody>
  {% for log in logs %}
    <tr>
      <td>{{ log.timestamp }}</td>
      <td>{{ log.username }}</td>
      <td>{{ log.action }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% elif log_type == 'inventory' %}
<table class="table table-striped table-fixed">
  <thead>
    <tr>
      <th>Tarih</th>
      <th>Tür</th>
      <th>Envanter No</th>
      <th>İşlem</th>
      <th>Kullanıcı Değişimi</th>
      <th>Konum Değişimi</th>
      <th>Not</th>
    </tr>
  </thead>
  <tbody>
  {% for log in logs %}
    <tr>
      <td>{{ log.change_date }}</td>
      <td>{{ log.inventory_type }}</td>
      <td>{{ log.inventory_no or log.inventory_id }}</td>
      <td>{{ log.action }}</td>
      <td>
        {% if log.old_user_name or log.new_user_name %}
          {{ log.old_user_name or '' }} &rarr; {{ log.new_user_name or '' }}
        {% endif %}
      </td>
      <td>
        {% if log.old_location or log.new_location %}
          {{ log.old_location or '' }} &rarr; {{ log.new_location or '' }}
        {% endif %}
      </td>
      <td>{{ log.note or '' }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}
{% endblock %}
