{% extends "base.html" %}

{% block title %}Kayıtlar{% endblock %}

{% block content %}
<div class="container mt-3">
  <div class="card">
    <div class="card-header">Kayıtlar</div>
    <div class="card-body p-0">
      <table class="table table-sm mb-0">
        <thead>
          <tr>
            <th>Tarih</th>
            <th>İşlem</th>
            <th>Önceki Kullanıcı</th>
            <th>Yeni Kullanıcı</th>
            <th>Önceki Konum</th>
            <th>Yeni Konum</th>
            <th>Not</th>
            <th>İşlemi Yapan</th>
          </tr>
        </thead>
        <tbody id="log-rows"></tbody>
      </table>
    </div>
  </div>
</div>
<script>
async function loadLogs(){
  const res = await fetch('/logs?limit=200');
  const rows = await res.json();
  const tbody = document.getElementById('log-rows');
  tbody.innerHTML = rows.map(r => `
    <tr>
      <td>${new Date(r.change_date).toLocaleString()}</td>
      <td>${r.action}</td>
      <td>${r.old_user_id ?? ''}</td>
      <td>${r.new_user_id ?? ''}</td>
      <td>${r.old_location ?? ''}</td>
      <td>${r.new_location ?? ''}</td>
      <td>${r.note ?? ''}</td>
      <td>${r.changed_by}</td>
    </tr>
  `).join('');
}
loadLogs();
</script>
{% endblock %}
